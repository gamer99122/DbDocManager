<Window x:Class="DbDocManager.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="資料表管理系統" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 工具列 -->
        <ToolBarTray Grid.Row="0">
            <ToolBar>
                <Button Content="重新整理" Command="{Binding LoadDataCommand}" Margin="2"/>
                <Separator/>
                <TextBox x:Name="SearchBox" Text="{Binding SearchKeyword, UpdateSourceTrigger=PropertyChanged}" 
                         Width="200" Margin="2" VerticalContentAlignment="Center"/>
                <Button Content="搜尋" Command="{Binding SearchCommand}" Margin="2"/>
                <Separator/>
                <Button Content="匯出全部" Command="{Binding ExportAllCommand}" Margin="2"/>
            </ToolBar>
        </ToolBarTray>

        <!-- 主要內容區域 -->
        <Grid Grid.Row="1" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <!-- 左側：表格列表 -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="資料表列表" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>

                <DataGrid Grid.Row="1" x:Name="TablesGrid" 
                          ItemsSource="{Binding Tables}" 
                          SelectedItem="{Binding SelectedTable}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          SelectionMode="Single"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="表格名稱" Binding="{Binding TableName}" Width="*" IsReadOnly="True"/>
                        <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="2*" IsReadOnly="True"/>
                        <DataGridTextColumn Header="更新時間" Binding="{Binding ModifiedAt, StringFormat=yyyy-MM-dd HH:mm}" Width="120" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>

                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,5,0,0">
                    <Button Content="新增表格" Command="{Binding AddTableCommand}" Margin="0,0,5,0" Padding="10,3"/>
                    <Button Content="編輯表格" Command="{Binding EditTableCommand}" Margin="0,0,5,0" Padding="10,3"/>
                    <Button Content="刪除表格" Command="{Binding DeleteTableCommand}" Margin="0,0,5,0" Padding="10,3"/>
                    <Button Content="匯出表格" Command="{Binding ExportTableCommand}" Margin="0,0,5,0" Padding="10,3"/>
                </StackPanel>
            </Grid>

            <!-- 分隔線 -->
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Gray"/>

            <!-- 右側：欄位列表 -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" FontWeight="Bold" FontSize="14" Margin="0,0,0,5">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="欄位列表 ({0})">
                            <Binding Path="SelectedTable.TableName" FallbackValue="未選擇表格"/>
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>

                <DataGrid Grid.Row="1" x:Name="ColumnsGrid" 
                          ItemsSource="{Binding Columns}" 
                          SelectedItem="{Binding SelectedColumn}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          SelectionMode="Single"
                          GridLinesVisibility="Horizontal"
                          HeadersVisibility="Column">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="欄位名稱" Binding="{Binding ColumnName}" Width="120" IsReadOnly="True"/>
                        <DataGridTextColumn Header="說明" Binding="{Binding Description}" Width="*" IsReadOnly="True"/>
                        <DataGridTextColumn Header="型別" Binding="{Binding DataType}" Width="100" IsReadOnly="True"/>
                        <DataGridCheckBoxColumn Header="可空" Binding="{Binding IsNullable}" Width="50" IsReadOnly="True"/>
                        <DataGridTextColumn Header="單位" Binding="{Binding Unit}" Width="60" IsReadOnly="True"/>
                        <DataGridTextColumn Header="範例" Binding="{Binding Example}" Width="100" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>

                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,5,0,0">
                    <Button Content="新增欄位" Command="{Binding AddColumnCommand}" Margin="0,0,5,0" Padding="10,3"/>
                    <Button Content="編輯欄位" Command="{Binding EditColumnCommand}" Margin="0,0,5,0" Padding="10,3"/>
                    <Button Content="刪除欄位" Command="{Binding DeleteColumnCommand}" Margin="0,0,5,0" Padding="10,3"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Window>